const express = require('express');
const bodyParser = require('body-parser');
const MongoModels = require('mongo-models');
var MongoClient = require('mongodb').MongoClient;
var url = "mongodb://localhost:27017/";
// create express app
const app = express();

// parse requests of content-type - application/x-www-form-urlencoded
app.use(bodyParser.urlencoded({ extended: true }))

// parse requests of content-type - application/json
app.use(bodyParser.json())

exports.insert = (req, res) => {
    const nameVal = req.query.firstname;
    console.log(nameVal);
    const emailVal = req.query.lastname;
    const phone = req.query.password;
    MongoClient.connect(url, function(err, db) {
      if (err) throw err;
      var dbo = db.db("Sample");
      var myobj = { name:nameVal, address: emailVal };
      dbo.collection("details").insertOne(myobj, function(err, response) {
        if (err) throw err;
        res.json({"message": "Inserted Successfully ."});
        db.close();
      });
    }); 
    console.log('Inserted Successfully');
};

exports.getData = (req, res) => {
    MongoClient.connect(url, function(err, db) {
        if (err) throw err;
        var dbo = db.db("Sample");
        dbo.collection("details").find({}).toArray(function(err, result) {
            if (err) throw err;
            res.json(result);
            db.close();
          });
      }); 
};